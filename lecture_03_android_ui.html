<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Android User Interface</title>

    <link rel="stylesheet" href="css/reveal.css">                    <!--slide style-->
    <link rel="stylesheet" href="css/theme/noveo.css" id="theme">    <!--noveo theme-->
    <link rel="stylesheet" href="lib/css/magula.css">                <!--code highlight-->
</head>
<body>
<div id="hidden" style="display: none">
    <div id="overlay">
        <div id="header-left"></div>
        <div id="header-right"></div>
        <div id="footer-right"></div>
    </div>
</div>
<div class="reveal">
    <div class="slides">
        <!--positioning content-->
        <section class="center noveo-title"
                 data-background-color="#fff"
                 data-background-image="css/theme/img/background_title.svg"
                 data-background-position="right bottom"
                 data-background-size="auto">
            <h1>Android User Interface</h1>
            <div class="title-separator"></div>
            <h2>автор:</h2>
            <p>Клещев Денис</p>
        </section>
        <section class="center center-horizontal">
            <h2>UI Overview</h2>
            <ul>
                <li>Весь графический интерфейс строится из объектов классов View и ViewGroup</li>
                <li>View - нечто, что может быть нарисованно на экране и с чем пользователь может взаимодействовать</li>
                <li>ViewGroup - наследник View, содержит в себе другие View и определяет как они будут расположенны относительно друг друга</li>
                <li>AdapterView - особый наследник ViewGroup, дочерние элементы которого задаются с помощью Adapter’a</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>UI Overview</h2>
            <img src="http://i.stack.imgur.com/vYsMp.png" height="600" width="1000">
        </section>
        <section class="center center-horizontal">
            <h2>Declaring Views</h2>
            <ul>
                <li>Дерево View может быть создано прямо в коде</li>
                <li>Более простой и предпочтительный способ - использовать XML</li>
                <li>Это декларативно (говорим что делать, а не как)</li>
                <li>Позволяет отделить графический интерфейс и логику</li>
                <li>Меньше усилий и более читабельно</li>
                <li>Переиспользуемо</li>
                <li>Для разных конфигураций могут быть созданы разные XML файлы, при этом коду знать об этом не обязательно</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>Common Views</h2>
            <ul>
                <li class="fragment" data-fragment-index="1">TextView - нередактируемое текстовое поле</li>
                <li class="fragment" data-fragment-index="2">EditText - редактируемое текстовое поле</li>
                <li class="fragment" data-fragment-index="3">ImageView – картинка</li>
                <li class="fragment" data-fragment-index="4">Button – кнопочка</li>
                <li class="fragment" data-fragment-index="5">CheckBox - галочка</li>
            </ul>
        </section>
                <section data-markdown="lecture/ui/attr.md"
                 data-separator-vertical="^\r?\n------\r?\n$"></section>
        <section class="center center-horizontal">
            <h2>Dimension Units</h2>
            <ul>
                <li>px - реальные пиксели на экране</li>
                <li>pt - points, 1/72 дюйма</li>
                <li>mm – миллиметры</li>
                <li>in – дюймы</li>
                <li>dp - density independent pixels. Количество пикселей одном dp зависит от плотности экрана</li>
                <li>sp - scaled pixels. Аналогичны dp + размер зависит от выбранного размера шрифта пользователем</li>
                <li>процентов нет*</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>Dimension Units</h2>
            <h4>Bad practice</h4>
            <img src="http://developer.android.com/images/screens_support/density-test-bad.png">
            <h4>Good practice</h4>
            <img src="http://developer.android.com/images/screens_support/density-test-good.png">            
        </section>
        </section>
                <section data-markdown="lecture/ui/drawable.md"
                 data-separator-vertical="^\r?\n------\r?\n$"></section>
        <section class="center center-horizontal">
            <h2>Input Handling</h2>
            <ul>
                <li>View.setOnClickListener</li>
                <li>View.setOnLongClickListener</li>
                <li>View.setOnFocusChangeListener</li>
                <li>View.setOnTouchListener</li>
                <li>TextView.addTextChangedListener</li>
                <li>CompoundButton.setOnCheckedChangeListener</li>
                <li>AdapterView.setOnItemClickListener</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>Common Layouts</h2>
            <ul>
                <li>FrameLayout - рисует дочерние View поверх друг друга</li>
                <li>LinearLayout - выстраивает свои элементы в одну линию</li>
                <li>RelativeLayout - хитро располагает элементы относительно друг друга</li>
                <li>ListView - список</li>
                <li>GridLayout - дочерние View располагаются по сеточке</li>
                <li>RecyclerView - современная замена ListView и GridLayout</li>
                <li>ScrollView - добавляет скролл, если контент слишком большой</li>
                <li>TableLayout - таблица для статичных данных</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>ListView, GridView</h2>
            <ul>
                <li>Отображение вертикального (ListView) или в виде таблицы (GridView) списка однотипных данных</li>
                <li>Переиспользует созданные вьюхи</li>
                <li>Можно добавлять хедеры и футеры</li>
                <li>Необходимо использовать класс Adapter</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView</h2>
            <ul>
                <li>Ничего не знает о расположении элементов</li>
                <li>Обязательное использование <b>ViewHolder</b></li>
                <li>Сам решает, когда, как и что кэшировать и переиспользовать</li>
                <li>Decoration Позволяет добавить любое "украшение" к любому элементу</li>
                <li>Можно сделать любое расположение элементов, но это сложнее</li>
                <li>Click handling - чуть сложнее чем в ListView и GridView</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView.LayoutManager</h2>
            <p>Определяет расположение элементов</p>
            <ul>
                <li class="fragment" data-fragment-index="1">LinearLayoutManager - список</li>
                <li class="fragment" data-fragment-index="2">GridLayoutManager - таблица</li>
                <li class="fragment" data-fragment-index="3">StaggeredGridLayoutManager - кривая таблица</li>
                <li class="fragment" data-fragment-index="4">Custom</li>
            </ul>
            <img class="fragment" data-fragment-index="4" src="https://i.ytimg.com/vi/NaSd2d5rwPE/hqdefault.jpg"/>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView.Adapter</h2>
            <p>Необходимо переопределить методы:</p>
            <ul>
                <li class="fragment" data-fragment-index="1">getItemCount() - количество элементов</li>
                <li class="fragment" data-fragment-index="2">onCreateViewHolder(ViewGroup parent, int viewType) - объясняет адаптеру, как создавать ViewHolder'ы</li>
                <li class="fragment" data-fragment-index="3">onBindViewHolder(ViewHolder holder, int position) - объясняет адаптеру, что делать с готовым ViewHolder'ом</li>
            </ul>
            <p class="fragment" data-fragment-index="4">Дополнительные полезные методы:</p>
            <ul class="fragment" data-fragment-index="4">
                <li class="fragment" data-fragment-index="4">getItemViewType(int position) - объясняет адаптеру, это что за покемон</li>
                <li class="fragment" data-fragment-index="5">getItemId(int position) - присваивает элементу айдишник</li>
                <li class="fragment" data-fragment-index="6">setHasStableIds(boolean hasStableIds) - заставляет адаптер использовать stableIds</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView.ViewHolder</h2>
            <div class="half-left">
                <pre class="fragment" data-fragment-index="1"><code class="normal" data-trim data-noescape>
                    class ViewHolder extends RecyclerView.ViewHolder {
                        ImageView avatar;
                        TextView userName;
                        RatingBar userRating;

                        public ViewHolder(View itemView) {
                            super(itemView);
                            avatar = (ImageView) 
                                itemView.findViewById(R.id.avatar);
                            ...
                        }
                    }
                </code></pre>
            </div>
            <div class="half-right">
                <pre class="fragment" data-fragment-index="2"><code class="normal" data-trim data-noescape>
                    class ViewHolder extends RecyclerView.ViewHolder {
                        @BindView(R.id.avatar)
                        ImageView avatar;
                        @BindView(R.id.user_name)
                        TextView userName;
                        @BindView(R.id.user_rating)
                        RatingBar userRating;

                        public ViewHolder(View itemView) {
                            super(itemView);
                            ButterKnife.bind(this, itemView);
                        }
                    }
                </code></pre>
            </div>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView. Refresh data</h2>
            <p>Есть несколько способов обновить данные recycleView. Есть структурные изменения и изменения конкретного элемента (или нескольких)</p>
            <ul>
                <li>notifyDataSetChanged() - что что-то произошло с данными, заставляет обновить все</li>
                <li>notifyItemChanged(int n) - изменился элемент n, перемещений нет</li>
                <li>notifyItemInserted(int n) - добавился элемент в позиции n, другие элементы не изменились</li>
                <li>notifyItemMoved (int fromPosition, int toPosition) - элемент был перемещен из позиции fromPosition в toPosition</li>
                <li>notifyItemRemoved(int n) - элемент в позиции n был удален</li>
                <li>notifyItemRangeChanged(int from, int n) - n элементов, начиная с from-того, изменились</li>
                <li>notifyItemRangeInserted(int from, int n) - добавлено n элементов, начиная с позиции from</li>
                <li>notifyItemRangeRemoved(int from, int n) - удалено n элементов, начиная с позиции from</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView. DiffUtil</h2>
            <ul>
                <li>Специальный класс, рассчитывающий разницу между двумя списками</li>
                <li>Используется для расчета обновлений для RecyclerView</li>
                <li>Если списки большие, может занять некоторое время</li>
                <li class="fragment" data-fragment-index="1">Можно вызвать на другом потоке, а DiffResult отдать на главный</li>
                <li class="fragment" data-fragment-index="1">Можно избавить DiffUtil от отслеживания перемещений элементов, что ускорит его работу</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView. DiffUtil</h2>
            <pre><code class="normal" data-trim data-noescape>
                DiffUtil.DiffResult diffResult = DiffUtil.calculateDiff(new DiffUtil.Callback() {
                    public int getOldListSize();
                    public int getNewListSize();
                    public boolean areItemsTheSame(int oldItemPosition, int newItemPosition);
                    public boolean areContentsTheSame(int oldItemPosition, int newItemPosition);
                }

                adapter.setItems(spotDatas);
                diffResult.dispatchUpdatesTo(adapter);
            </code></pre>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView. Click handling</h2>
            <p>Good practice:</p>
            <pre><code class="normal" data-trim data-noescape>
                ItemClickSupport.addTo(mRecyclerView).setOnItemClickListener(new ItemClickSupport.OnItemClickListener() {
                    @Override
                    public void onItemClicked(RecyclerView recyclerView, int position, View v) {
                        // do it
                    }
                });
            </code></pre>
            <p>Добавить в ids.xml:</p>
            <pre><code class="normal" data-trim>
                <?xml version="1.0" encoding="utf-8"?>
                <resources>
                    <item name="item_click_support" type="id"></item>
                </resources>
            </code></pre>
        </section>
        <section class="center center-horizontal">
            <h2>RecyclerView</h2>
            <p>Использование RecyclerView</p>
            <pre><code class="normal" data-trim data-noescape>
                final RecyclerView recycler; //init it
                final MyAwesomeAdapter adapter = new MyAwesomeAdapter(getItems());

                recycler.setLayoutManager(new LinearLayoutManager(getContext()));

                recycler.addItemDecoration(new ImageDecorator());
                recycler.addItemDecoration(new TextDecorator());
                recycler.addItemDecoration(new VerticalSpaceDecorator(20));

                recycler.setAdapter(adapter);

                ItemClickSupport.addTo(recycler)
                    .setOnItemClickListener((recyclerView, position, v) -> 
                        Log.d("OnItemClick", "Item click: " + position));
            </code></pre>
        </section>
        <section data-markdown="lecture/ui/xml_example.md"></section>
        <section class="center center-horizontal">
            <h2>CardView</h2>
            <img src="lecture/ui/card_view.png">
        </section>
        <section class="center center-horizontal">
            <h2>Custom View</h2>
            <ul>
                <li>Позволяет задавать свои аттрибуты</li>
                <li>Расширение существующей View (например TextView)</li>
                <li>Не занимается ничем, кроме отображения данных и взаимодействия с юзером</li>
                <li>Не выполняет лишнюю работу по отрисовке</li>
                <li>Корректно отрисовывается в превью студии</li>
                <li>Действительно необходима и ее функционал не может быть реализован стандартными средствами</li>
            </ul>
        </section>
        <section class="center center-horizontal">
            <h2>Custom View: аттрибуты</h2>
            <p>Описание атрибутов в res/values/attrs.xml</p>
            <ul>
                <li>declare-styleable 
                    <ul>
                        <li>name - имя класса</li>
                    </ul>
                </li>
                <li>attr
                    <ul>
                        <li>name - имя атрибута, который будет использоваться в разметке</li>
                        <li>format - тип атрибута
                            <ul>
                                <li>integer</li>
                                <li>float</li>
                                <li>string</li>
                                <li>color</li>
                                <li>dimension</li>
                                <li>reference</li>
                                <li>...</li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </section>
        <section data-markdown="lecture/ui/card.md"></section>
        <section class="center center-horizontal">
            <h2>Custom Views: Наследование</h2>
            <ol type="1">
                <li>Получить атрибуты в конструкторе
                    <pre><code class="normal" data-trim data-noescape>
                        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.CustomImageView);
                    </code></pre>
                </li>
                <li>Получить нужные значения
                    <pre><code class="normal" data-trim data-noescape>
                        Drawable foregroundDrawable = 
                            a.getDrawable(R.styleable.CustomImageView_param);

                        float margin = 
                            a.getDimension(R.styleable.CustomImageView_param, 0);
                    </code></pre>
                </li>
                <li>Не забыть освободить ресуры обратно
                    <pre><code class="big" data-trim data-noescape>
                        a.recycle();
                    </code></pre>
                </li>
            </ol>
        </section>
        <section class="center center-horizontal">
            <h2>Custom Views: Наследование</h2>
            <ul>
                <li>onDraw</li>
                <li>onTouchEvent</li>
                <li>onMeasure</li>
                <li>onSizeChanged</li>
                <li>...</li>
            </ul>
        </section>
        <section data-markdown="lecture/ui/custom_view_usage.md"></section>
        <section>
            <h2>Дополнительные ссылки</h2>
            <ul>
                <li><p><a href="http://developer.android.com/guide/topics/ui/index.html">User Interface</a></p></li>
                <li><p><a href="http://developer.android.com/training/best-ui.html">Best Practices for User Interface</a></p></li>
                <li><p><a href="http://developer.android.com/training/improving-layouts/index.html">Improving Layout Performance</a></p></li>
                <li><p><a href="http://developer.android.com/training/custom-views/index.html">Creating Custom Views</a></p></li>
                <li><p><a href="http://developer.android.com/reference/android/view/View.html">View</a></p></li>
                <li><p><a href="http://developer.android.com/guide/topics/ui/custom-components.html">Custom Components</a></p></li>
                <li><p><a href="http://developer.android.com/guide/topics/resources/drawable-resource.html">Drawable Resources</a></p></li>
                <li><p><a href="http://developer.android.com/training/improving-layouts/optimizing-layout.html">Optimizing Layout Hierarchies</a></p></li>
                <li><p><a href="https://developer.android.com/training/material/lists-cards.html">Creating Lists and Cards</a></p></li>
                <li><p><a href="https://www.littlerobots.nl/blog/Handle-Android-RecyclerView-Clicks/">Getting your clicks on RecyclerView</a></p></li>
            </ul>
        </section>
    </div>
</div>

<script src="lib/js/head.min.js"></script>      <!--HeadJS functions-->
<script src="js/reveal.js"></script>            <!--RevealJS functions-->
<script src="js/config.js"></script>            <!--RevealJS config-->

<script src="lib/js/jquery-3.2.1.min.js"></script>
<script src="js/printpdf.js"></script>
</body>
</html>

Reveal.initialize({
    center: true
})